C51 COMPILER V9.00   LED                                                                   05/12/2018 13:35:45 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE LED
OBJECT MODULE PLACED IN LED.OBJ
COMPILER INVOKED BY: D:\51\C51\BIN\C51.EXE LED.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*-----------------------------------------------
   2          名称：数码管显示红外遥控器中(1-9)键值
   3          
   4          内容：按配套遥控器上的1-9按键会在数码管上对应显示,注意其它按键没有反应的。
   5          ------------------------------------------------*/
   6          #include<reg52.h>
   7          #define uint unsigned int
   8          #define uchar unsigned char   
   9          
  10          sbit ir=P3^2;
  11            
  12          sbit LED_GPIO=P3^4;  
  13          sfr P3M0 = 0xB2;
  14          sfr P3M1 = 0xB1;
  15          
  16          
  17          
  18          //sbit dula=P2^6;
  19          //sbit wela=P2^7;
  20          uchar irtime;
  21          bit irprosok,irok;
  22          uchar irtime;
  23          
  24          //uchar code table_du[10]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};// 显示段码值0~9
  25          uchar irtime;
  26          bit irprosok,irok;
  27          uchar ircode[4];
  28          uchar irdata[33];
  29          uchar startflag;
  30          uchar  bitnum;
  31          
  32          void timer0init(void)//定时器0初始化 256*(1/12m)*12=0.256ms
  33          {
  34   1      
  35   1        TMOD=0x02;//定时器0工作方式2，TH0是重装值，TL0是初值
  36   1        TH0=0x00; //重载值
  37   1        TL0=0x00; //初始化值
  38   1        ET0=1;    //开中断
  39   1        TR0=1;    
  40   1      }
  41          
  42          
  43          void tim0_isr (void) interrupt 1 using 1  //定时器0中断服务函数
  44          {
  45   1        irtime++;  //用于计数2个下降沿之间的时间
  46   1      }
  47          
  48          
  49          void int0init(void)  //外部中断0初始化
  50          {
  51   1       IT0 = 1;   //指定外部中断0下降沿触发，INT0 (P3.2)
  52   1       EX0 = 1;   //使能外部中断
  53   1       EA = 1;    //开总中断
  54   1      }
  55          
C51 COMPILER V9.00   LED                                                                   05/12/2018 13:35:45 PAGE 2   

  56          
  57          void int0 () interrupt 0 //外部中断0服务函数
  58          {
  59   1      if(startflag)
  60   1       {
  61   2        if(irtime>32&&irtime<63)  //8-16ms
  62   2              {
  63   3                 bitnum=0;
  64   3              }
  65   2              irdata[bitnum]=irtime;
  66   2              irtime=0;
  67   2              bitnum++;
  68   2              if(bitnum==33)
  69   2                {
  70   3                 bitnum=0;
  71   3                 irok=1;
  72   3                }
  73   2       }
  74   1      else
  75   1       {
  76   2       irtime=0;
  77   2       startflag=1;
  78   2       }
  79   1      }
  80          
  81          
  82          void irpros(void) // 红外码值处理
  83          {
  84   1              uchar mun,k,i,j;
  85   1              k=1;
  86   1              for(j=0;j<4;j++)
  87   1              {
  88   2                      for(i=0;i<8;i++)
  89   2                      {
  90   3                              mun=mun>>1;
  91   3                              if(irdata[k]>6)
  92   3                              {
  93   4                                      mun=mun | 0x80;
  94   4                              }
  95   3                                      k++;
  96   3                      }
  97   2                      ircode[j]=mun;
  98   2              }
  99   1              irprosok=1;
 100   1      }
 101          
 102          
 103          void ir_work(void) //红外键值处理
 104          {
 105   1              switch(ircode[2])   //判断第三个数码值
 106   1                       {
 107   2                               case 0x0c:LED_GPIO = 1; 
 108   2      //                       P0=table_du[1];
 109   2                               break;//1 显示相应的按键值
 110   2                               case 0x18:LED_GPIO = 0; 
 111   2      //                       P0=table_du[2];
 112   2                               break;//2
 113   2      //                       case 0x5e:P0=table_du[3];break;//3
 114   2      //                       case 0x08:P0=table_du[4];break;//4
 115   2      //                       case 0x1c:P0=table_du[5];break;//5
 116   2      //                       case 0x5a:P0=table_du[6];break;//6
 117   2      //                       case 0x42:P0=table_du[7];break;//7
C51 COMPILER V9.00   LED                                                                   05/12/2018 13:35:45 PAGE 3   

 118   2      //                       case 0x52:P0=table_du[8];break;//8
 119   2      //                       case 0x4a:P0=table_du[9];break;//9
 120   2                   default:break;
 121   2                               }
 122   1                        irprosok=0;//处理完成标志
 123   1        }
 124          
 125          
 126          void main(void)
 127          {
 128   1       int0init(); //初始化外部中断
 129   1       timer0init();//初始化定时器
 130   1       P3M0 = 0x10;            //P3.4强推挽输出
 131   1       P3M1 = 0x00;            //P3.4强推挽输出
 132   1        LED_GPIO = 0;
 133   1      //  P0=0x00; //数码管清屏
 134   1      //  wela=1;      //位锁存
 135   1      //  wela=0;
 136   1      
 137   1       while(1)//主循环
 138   1         {
 139   2          if(irok)       //如果接收好了进行红外处理
 140   2                {   
 141   3                 irpros();
 142   3                 irok=0;
 143   3                }
 144   2      //      LED_GPIO = 1;
 145   2          if(irprosok)  //如果处理好后进行工作处理
 146   2                {
 147   3                 ir_work();
 148   3                }
 149   2         }
 150   1      }
 151            
 152            


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    179    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     40    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
